<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Design Patterns in Python | Derek&#39;s Hub</title>
<meta name="keywords" content="">
<meta name="description" content="As a super flexible language, Python is blazing fast to build working prototypes and get the steam going.
At the same time, it can also end up becoming a messy codebase and a pain to read later if being careless in the coding style.
Therefore, I would always prefer to look out for idiomatic patterns to keep the Python code maintainable and easy to work with (both for me and others).">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/design-pattern-py/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.31a038ca4fe29d231a9edae8087cf7ea016d84e6abeb8663f248bda38b0d511b.css" integrity="sha256-MaA4yk/inSMantroCHz36gFthOar64Zj8ki9o4sNURs=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/design-pattern-py/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Derek&#39;s Hub (Alt + H)">Derek&#39;s Hub</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Design Patterns in Python
    </h1>
    <div class="post-meta"><span title='2025-09-23 19:00:53 +0800 +08'>September 23, 2025</span>&nbsp;·&nbsp;5 min

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#singleton" aria-label="Singleton">Singleton</a></li>
                <li>
                    <a href="#decorator" aria-label="Decorator">Decorator</a></li>
                <li>
                    <a href="#iterator" aria-label="Iterator">Iterator</a></li>
                <li>
                    <a href="#builder" aria-label="Builder">Builder</a></li>
                <li>
                    <a href="#observer" aria-label="Observer">Observer</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>As a super flexible language, Python is blazing fast to build working prototypes and get the steam going.
At the same time, it can also end up becoming a messy codebase and a pain to read later if being careless in the coding style.</p>
<p>Therefore, I would always prefer to look out for idiomatic patterns to keep the Python code maintainable and easy to work with (both for me and others).</p>
<h3 id="singleton">Singleton<a hidden class="anchor" aria-hidden="true" href="#singleton">#</a></h3>
<p>It means only one instance of the class should exist during a program&rsquo;s lifetime.</p>
<p>A refresher on the Python object creation process:</p>
<ul>
<li><code>__new__(cls)</code>: the very first step to allocate memory for the raw instance</li>
<li><code>__init__(self)</code>: fills in the details (attributes) for the new instance object returned by the above step</li>
</ul>
<p>Now, we want to have a shared cache object:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python3" data-lang="python3"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SingleCache</span>:
</span></span><span style="display:flex;"><span>    _instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span> <span style="color:#75715e"># class-level attribute</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __new__(cls):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># allocate new instance only when there isn&#39;t one; otherwise it reuses the same one</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> cls<span style="color:#f92672">.</span>_instance:
</span></span><span style="display:flex;"><span>            cls<span style="color:#f92672">.</span>_instance <span style="color:#f92672">=</span> super()<span style="color:#f92672">.</span>__new__(cls) <span style="color:#75715e"># all class inherits from &#39;object&#39;</span>
</span></span><span style="display:flex;"><span>            cls<span style="color:#f92672">.</span>_instance<span style="color:#f92672">.</span>_cache <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> cls<span style="color:#f92672">.</span>_instance
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set</span>(self, k, v, ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>):
</span></span><span style="display:flex;"><span>        expiry <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">+</span> ttl
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_cache[k] <span style="color:#f92672">=</span> (v, expiry) <span style="color:#75715e"># self = cls._instance = obj returned by __new__()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get</span>(self, k):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> k <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>_cache:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        v, expiry <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_cache[k]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">&gt;</span> expiry:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>_cache[k]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> v
</span></span></code></pre></div><p>Another thing to note, in Python, modules are imported once per interpreter. Every import just reuses the same module object.
So we can actually define the singleton object at the module level.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># single_cache.py</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SingleCache</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;initialise all attributes...&#34;</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_cache <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cache <span style="color:#f92672">=</span> SingleCache()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and then use it from other places</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> single_cache <span style="color:#f92672">import</span> SingleCache
</span></span></code></pre></div><h3 id="decorator">Decorator<a hidden class="anchor" aria-hidden="true" href="#decorator">#</a></h3>
<p>It is arguably the most Python-native design pattern more than anything else.
The decorator wraps around the core function to add behaviours immediately before and after its execution.</p>
<p>From my experience, it is most useful to add observability, caching and recovery mechanism around functions in the least disturbing way possible.</p>
<p>It looks self-explanatory in its minimal form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decorator</span>(func):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">wrapper</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs): <span style="color:#75715e"># just pass in positional &amp; keyword arguments that func accepts</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;set up before the func&#34;</span>)
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> func(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;modifications after the func&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> wrapper
</span></span></code></pre></div><p>A practical example if we want to profile compute-heavy operations in the time dimension is to have a timer decorator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> functools <span style="color:#f92672">import</span> wraps
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">time_it</span>(func):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># preserve original func metadata (__name__, __doc__) instead of being overridden by wrapper function</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># in order to keep a less confusing call stack</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@wraps</span>(func)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">wrapper</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
</span></span><span style="display:flex;"><span>        start <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> func(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
</span></span><span style="display:flex;"><span>        elapsed <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>func<span style="color:#f92672">.</span>__name__<span style="color:#e6db74">}</span><span style="color:#e6db74"> completed in </span><span style="color:#e6db74">{</span>elapsed<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> seconds&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> wrapper
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># now we use it</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &#39;@time_it&#39; is actually a syntactic sugar for the full form: </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># slow_compute = time_it(slow_compute)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@time_it</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">slow_compute</span>():
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;done&#34;</span>
</span></span></code></pre></div><p>In fact, there are a lot of pre-built decorators we can just plug in and use:</p>
<ul>
<li><code>@timing</code>: measure function execution time</li>
<li><code>@log_exceptions</code>: log exception with the function name</li>
<li><code>@functools.lru_cache(maxsize=16)</code>: cache function results to be re-used for the same calling arguments</li>
<li><code>@retry(times=3, delay=1)</code>: re-execute the function that might fail due to transient errors (e.g. rate limits)</li>
<li><code>@singleton</code>: decorate around class definition to enforce only one instance is ever created</li>
</ul>
<h3 id="iterator">Iterator<a hidden class="anchor" aria-hidden="true" href="#iterator">#</a></h3>
<p>It allows us to traverse through a collection of elements sequentially without worrying about how the internal data structure looks like in order to do it.</p>
<p>The pattern boils down to a protocol of 2 APIs:</p>
<ul>
<li><code>__iter__()</code>: return an iterator</li>
<li><code>__next()</code>: return the next item, or raise <code>StopIteration</code> when we exhaust the collection</li>
</ul>
<p>Any object that implements the above two is an iterator. Any object that implements only <code>__iter__()</code> is an iterable.</p>
<p>It might look natural that we traverse through a list using for-loop:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>nums <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> nums:
</span></span><span style="display:flex;"><span>    print(n) <span style="color:#75715e"># 1, 2, 3</span>
</span></span></code></pre></div><p>And the for-loop syntax is actually interpreted as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>it <span style="color:#f92672">=</span> iter(nums)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> next(it)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">StopIteration</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span></code></pre></div><p>A practical use is when we want to process a huge log file, instead of loading everything in memory at once, we can design an iterator
to load the data bit by bit for more efficient memory footprint.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BigFileIterator</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, path, chunk_size<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>path <span style="color:#f92672">=</span> path
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>chunk_size <span style="color:#f92672">=</span> chunk_size
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>buffer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>file <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __iter__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>file <span style="color:#f92672">=</span> open(self<span style="color:#f92672">.</span>path, <span style="color:#e6db74">&#34;r&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __next__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># only return one line at a time</span>
</span></span><span style="display:flex;"><span>            newline <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>buffer<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> newline <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                line <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>buffer[:newline]
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>buffer <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>buffer[newline <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> line
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># only load &#39;chunk_size&#39; amount of data into memory buffer at a time</span>
</span></span><span style="display:flex;"><span>            chunk <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>file<span style="color:#f92672">.</span>read(self<span style="color:#f92672">.</span>chunk_size)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> chunk:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>buffer:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_flush()  <span style="color:#75715e"># EOF - flush the remaining buffer</span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>file<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">StopIteration</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>buffer <span style="color:#f92672">+=</span> chunk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_flush</span>(self):
</span></span><span style="display:flex;"><span>        _line <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>buffer
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>buffer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> _line
</span></span></code></pre></div><p>This is just an illustration of how lazy loading can be effective in dealing with large data using iterator.
In reality, it would be better to design such usage as a <strong>context manager</strong> where file handle is properly opened and closed upon enter and exit.</p>
<h3 id="builder">Builder<a hidden class="anchor" aria-hidden="true" href="#builder">#</a></h3>
<p>It allows us to construct complex objects with many optional parameters step by step instead of having a gigantic constructor or assigning attributes all over the place.</p>
<p>The builder uses method chaining to make the same task look cleaner and more extensible, and encourages immutability after creation.</p>
<p>For instance, we want to build a custom HTTP client. It can be done in a very modular way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> dataclasses <span style="color:#f92672">import</span> dataclass
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@dataclass</span> <span style="color:#75715e"># automatically generate __init__ method</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HttpClientConfig</span>:
</span></span><span style="display:flex;"><span>    base_url: str
</span></span><span style="display:flex;"><span>    time_out: int
</span></span><span style="display:flex;"><span>    retries: int
</span></span><span style="display:flex;"><span>    headers: dict
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HttpClient</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, config: HttpClientConfig):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_config <span style="color:#f92672">=</span> config
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_init_session()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_init_session</span>(self):
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;set up the request session...&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get</span>(self, path: str):
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;GET </span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>_config<span style="color:#f92672">.</span>base_url<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>path<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HttpClientBuilder</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, base_url: str):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_base_url <span style="color:#f92672">=</span> base_url
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_time_out <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_retries <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_headers <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">with_timeout</span>(self, seconds: int):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_time_out <span style="color:#f92672">=</span> seconds
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">with_retries</span>(self, retries: int):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_retries <span style="color:#f92672">=</span> retries
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">with_headers</span>(self, headers: dict):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_headers <span style="color:#f92672">=</span> headers
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">build</span>(self):
</span></span><span style="display:flex;"><span>        cfg <span style="color:#f92672">=</span> HttpClientConfig(
</span></span><span style="display:flex;"><span>            base_url<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_base_url,
</span></span><span style="display:flex;"><span>            time_out<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_time_out,
</span></span><span style="display:flex;"><span>            retries<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_retries,
</span></span><span style="display:flex;"><span>            headers<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_headers
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> HttpClient(cfg)
</span></span></code></pre></div><h3 id="observer">Observer<a hidden class="anchor" aria-hidden="true" href="#observer">#</a></h3>
<p>Because functions are first-class in Python, it is easy to create a simple observer pattern to broadcast events to all interested components.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Notification</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>subscribers <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">subscribe</span>(self, call_back):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>subscribers<span style="color:#f92672">.</span>append(call_back)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">notify</span>(self, event):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> fn <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>subscribers:
</span></span><span style="display:flex;"><span>            fn(event)
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="next" href="http://localhost:1313/posts/go-http/">
    <span class="title">Next »</span>
    <br>
    <span>Bits and pieces of HTTP in Go</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>© <a href="https://github.com/adityatelange/hugo-PaperMod/graphs/contributors">PaperMod Contributors</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
